let balls = [] 
let initialNumberOfBalls = 5

const SPEED = 20


function setup() {
  createCanvas(600, 600)
  ellipseMode(RADIUS)
  resetAllBalls()
}

function draw() {
  fill(0)
  background(0)
  
  
  for( let ball of balls ) { 
    drawBall(ball)
    updateBall(ball)
    keepInBounds(ball)
  }
  
 
  for( let i = 0; i < balls.length - 1; i++ ) { 
    for( let j = i+1; j < balls.length; j++ ) {
      bounceBalls(balls[i], balls[j])
   }
  }
}


function ballsCollide(ballA, ballB) {
  return dist( ballA.position.x, ballA.position.y, ballB.position.x, ballB.position.y ) <= ballA.radius + ballB.radius
}

function bounceBalls(ballA, ballB) {
  if( ballsCollide(ballA, ballB) ) {
    ballA.velocity.x *= -1;
  
    ballB.velocity.x *= -1;
   
  }
}


function keepInBounds(ball) {
  if( ball.position.x + ball.radius > width ) {
     ball.velocity.x *= -1; 
  }

  if( ball.position.y + ball.radius > height ) {
    ball.velocity.y *= -1; 
  }

  if( ball.position.x - ball.radius < 0 ) {
    ball.velocity.x *= -1; 
  }

  if( ball.position.y - ball.radius < 0 ) {
    ball.velocity.y *= -1; 
  }
}

function resetAllBalls() {
  balls = [] 
  while( balls.length < initialNumberOfBalls ) {
    createBall()
  }
}

function mouseClicked() {
  rotateCreateBall()  
}

function rotateCreateBall() {
  balls.shift() 
  createBall() 
}

function keyPressed() {
  if( key === 'r' ) {
    resetAllBalls()
  }

  
  if( key === ' ' ) {
    createBall()
  }
}

function updateBall(ball) {
  ball.position.y = ball.position.y + ball.velocity.y;
  ball.position.x = ball.position.x + ball.velocity.x;  
}

function drawBall(ball) { 
  fill(ball.c);
  circle(ball.position.x,ball.position.y,ball.radius);  
}

function createBallAt(position) {
  let newBall = {} 
  
  newBall.radius = random(20,20)
  newBall.position = position
  
  for( let ball of balls ) {
    if( ballsCollide(ball,newBall) ) {
      return createBall()
    }
  }
    
  newBall.c = color(random(256),random(256),random(256))
    
  newBall.velocity = {
    x: random(-SPEED,SPEED),
    y: random(SPEED,SPEED)
  }
    
  balls.push(newBall)
}


function createBall() {
  createBallAt({
    x: random(20, width-20),
    y: random(20,20)
  });
}
